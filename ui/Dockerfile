FROM alpine

RUN apk update \
    && apk add ruby-dev ruby-json ruby-bundler g++ make

ENV APP_HOME /app

RUN mkdir $APP_HOME

WORKDIR $APP_HOME

ADD Gemfile* $APP_HOME/

RUN bundle install

ADD . $APP_HOME

ENV POST_SERVICE_HOST web_post
ENV POST_SERVICE_PORT 5000
ENV COMMENT_SERVICE_HOST web_comment
ENV COMMENT_SERVICE_PORT 9292
CMD ["puma"]
